<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>笔趣阁小说阅读</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/bookInfo.css">
</head>
<style>

</style>
<body>
<!--顶部导航栏-->
<nav class="nav  nav-tabs navbar-inverse" role="navigation">
    <div class="container-fluid">
        <!--顶部左侧导航栏-->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#example-navbar-collapse">
                <span class="sr-only">切换导航</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a  class="navbar-brand" href="/">笔趣阁手机版</a>
        </div>
    </div>
</nav>

<%include header.ejs%>
<%include search.ejs%>
<div class="container">
<div class="intro">你的书架</div>
    <div class="bookShelf">
    <!--用户书架列表展示-->
    <ul>
        <% bookArray.result.forEach(function(bookData){%>
        <li class="row" id="book-<%= bookData.bookId %>">
            <div class="bookImg">
                <a href="/bookInfo/<%= bookData.bookId %>">
                    <img class="img-thumbnail" alt="封面" id="bookImg" src='/images/bookImg/<%= bookData.bookId %>.jpg' width=110px height=140px>
                </a>
            </div>
            <div class="bookInfo">
                <h2><a href='/bookInfo/<%= bookData.bookId %>'><%= bookData.bookName %></a>
                    <button type="button" class="btn btn-danger" onclick="deleteBook(<%= bookData.bookId %>)">移除本书</button>
                </h2>
                <p>作者：<a href='/author/<%= bookData.authorName %>'><%= bookData.authorName %></a></p>
                <p>分类：<%= bookData.bookTypeName %></p>
                <p>状态：<% if (bookData.status == 1) { %>连载中<% }else { %>已完结<% } %></p>
                <p>更新：<%= bookData.updateTime%></p>
                <p>最新：<a href="/bookChapter/<%= bookData.bookId %>/<%= bookData.latestChapter %>">
                        <%= bookData.latestChTitle %></a></p>
            </div>
        </li>
        <% }) %>
    </ul>
</div>
</div>
<%- include footer.ejs %>
<script>
    function formateDate(date) {
        var date = new Date(date);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        var d = date.getDate();
        var h = date.getHours();
        var mi = date.getMinutes();
        var sec = date.getSeconds();
        m = m > 9 ? m : '0' + m;
        alert("y:"+y+"m:"+m+"d:"+d+"h:"+h+"mi:"+mi);
        return y + '-' + m + '-' + d + ' ' + h + ':' + mi + ':'+sec;
    }
    //删除书籍
    function deleteBook(bookId){
        const userId = '<%=bookArray.userId%>';
        console.log(userId);
        console.log(bookId);
        if(userId == '' || bookId == ''){
            alert("用户名或书号不存在");
            return;
        }
        const con = confirm( "确定删除该书么" ); //在页面上弹出确认对话框
        if (con== false )return;
        $('.btn').prop('disabled', true);
        $.post('http://192.168.0.109:3000/bookShelf/removeBook', {userId: userId, bookId: bookId},
            function (result) {
                if (result.success) {
                    //移除HTML节点
                    $("#book-"+bookId).remove();
                    console.log("#book-"+bookId);
                    alert("移除成功");
                }else{
                    alert(result.msg);
                }
            });
        $('.btn').prop('disabled', false);
    }
</script>
</body>
</html>